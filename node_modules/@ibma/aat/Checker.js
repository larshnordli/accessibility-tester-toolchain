/******************************************************************************
 * Licensed Materials - Property of IBM
 * "Restricted Materials of IBM"
 * Â© Copyright IBM Corp. 2016 All Rights Reserved.
 *
 * Copying, redistribution and/or modification is prohibited.
 * U.S. Government Users Restricted Rights - Use, duplication or
 * disclosure restricted by GSA ADP Schedule Contract with IBM Corp.
 *****************************************************************************/
var IBMa={};!function(){"undefined"==typeof String.prototype.startswith&&(String.prototype.startswith=function(e){return this.substring(0,e.length)==e}),"undefined"==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^[\s\n]+|[\s\n]+$/g,"")}),IBMa.Error=IBMa.Error||{log:function(){if(console)try{console.log.apply(null,arguments)}catch(e){console.log(arguments)}}},IBMa.Dom={},IBMa.Dom.NodeWalker=function(e,n){this.node=e,this.bEndTag=void 0==n?!1:1==n},IBMa.Dom.NodeWalker.prototype.nextNode=function(){if(!this.bEndTag&&this.node.firstChild)this.node=this.node.firstChild;else if(this.node.nextSibling)this.node=this.node.nextSibling,this.bEndTag=!1;else{if(!this.node.parentNode)return!1;this.node=this.node.parentNode,this.bEndTag=!0}return!0},IBMa.Dom.NodeWalker.prototype.prevNode=function(){if(this.bEndTag&&this.node.lastChild)this.node=this.node.lastChild,this.bEndTag=!0;else if(this.node.previousSibling)this.node=this.node.previousSibling,this.bEndTag=!0;else{if(!this.node.parentNode)return!1;this.node=this.node.parentNode,this.bEndTag=!1}return!this.bEndTag||null!=this.node.firstChild&&"undefined"!=typeof this.node.firstChild||(this.bEndTag=!1),!0},IBMa.Context=function(e){this.attrCache=[],this.contextStr=e.trim().toLowerCase();var n=this.contextStr.indexOf("[");this.elementStr=-1==n?this.contextStr:this.contextStr.substring(0,n);var t=-1==n?null:this.contextStr.substring(n);if(null!=t)for(var o=t.split("]"),a=0;a<o.length;++a){var r={neq:!1},i=o[a].indexOf("=="),l=o[a].indexOf("!=");-1==i&&-1==l?(r.key=o[a].substring(2).trim(),r.value=null):-1!=i?(r.key=o[a].substring(2,i).trim(),r.value=o[a].substring(i+1).trim()):(r.key=o[a].substring(2,l).trim(),r.value=o[a].substring(l+1).trim(),r.neq=!0),null!=r.value&&(r.value=r.value.substring(2,r.value.length-1)),r.key.length>0&&this.attrCache.push(r)}},IBMa.Context.prototype.getElement=function(){return this.elementStr},IBMa.Context.prototype.attrsMatch=function(e){for(var n=!0,t=0;n&&t<this.attrCache.length;++t){var o=this.attrCache[t];n=(o.neq||e.hasAttribute(o.key))&&(null==o.value||o.neq!=(e.getAttribute(o.key)==o.value))}return n},IBMa.Config=IBMa.Config||{DEBUG:!1,ITER_COUNT:100,includeNodes:!0,includeBounds:!0,includePassed:!1,includeVisibility:!0,rules:{},rulesById:{},metadata:{},metadataId:{},rs:{},rsMap:{},nls:{},locale:"en-us",loaded:!1,setTimeout:function(e,n){window.setTimeout(e,n)},clearRules:function(){IBMa.Config.rules={},IBMa.Config.rulesById={}},addRule:function(ruleObj){if(ruleObj.id in IBMa.Config.rulesById)return void console.log("addRule::Rule "+ruleObj.id+" already exists - skipping");"undefined"==typeof ruleObj.enabled&&(ruleObj.enabled=!0),ruleObj.ctxs=IBMa.Config.getContexts(ruleObj),ruleObj.oldValidate=ruleObj.validate,"function"!=typeof ruleObj.oldValidate&&(ruleObj.oldValidate=eval("("+ruleObj.oldValidate+")")),ruleObj.validate=function(e){var n=ruleObj.oldValidate(e);return typeof n==typeof!0?{result:n,msgArgs:[]}:n};for(var elem in ruleObj.ctxs)elem in IBMa.Config.rules||(IBMa.Config.rules[elem]=[]),IBMa.Config.rules[elem].push(ruleObj);IBMa.Config.rulesById[ruleObj.id]=ruleObj},addRules:function(e){for(var n=0;n<e.length;++n)IBMa.Config.addRule(e[n])},getMatchingRules:function(e){var n=[];if(1==e.nodeType){var t=e.nodeName.toLowerCase();if(t in IBMa.Config.rules)for(var o=IBMa.Config.rules[t],a=0;a<o.length;++a)for(var r=0;r<o[a].ctxs[t].length;++r)if(o[a].ctxs[t][r].attrsMatch(e)){n.push(o[a]);break}if(t="*",t in IBMa.Config.rules)for(var o=IBMa.Config.rules[t],a=0;a<o.length;++a)for(var r=0;r<o[a].ctxs[t].length;++r)if(o[a].ctxs[t][r].attrsMatch(e)){n.push(o[a]);break}}return n},getContexts:function(e){var n,t=e.context;n=-1==t.indexOf("|")?[t]:t.split("|");for(var o={},a=0;a<n.length;++a){var r=new IBMa.Context(n[a]),i=r.getElement();i in o||(o[i]=[]),o[i].push(r)}return o},addMetadata:function(e){for(var n=0;n<e.length;++n)e[n].ruleId in IBMa.Config.metadata||(IBMa.Config.metadata[e[n].ruleId]=[]),IBMa.Config.metadata[e[n].ruleId].push(e[n]),IBMa.Config.metadataId[e[n].id]=e[n]},getMetadataForRule:function(e){return IBMa.Config.metadata[e]},addRuleset:function(e){IBMa.Config.rs[e.id]=e;for(var n=e,t=0;t<n.requirements.length;++t){var o=n.requirements[t];for(var a in o.rules)IBMa.Config.rsMap[a]=IBMa.Config.rsMap[a]||[],IBMa.Config.rsMap[a].push({rs:{id:e.id,label:IBMa.Config.getNLS(n.nameCode)},requirement:{id:o.criterionNumber,label:IBMa.Config.getNLS(o.criterionDesc),level:IBMa.Config.getNLS(o.criterionLevel)},levelCode:o.rules[a].severityCode})}},getAllRulesets:function(){return IBMa.Config.rs},getRulesetById:function(e){return IBMa.Config.rs[e]},addNLS:function(e,n){e=e.toLowerCase(),IBMa.Config.nls[e]=IBMa.Config.nls[e]||{};for(var t in n)IBMa.Config.nls[e][t]=n[t]},setLocale:function(e){e=e.toLowerCase()},getPageLocale:function(e){var n=e.documentElement;return n.hasAttribute("lang")?n.getAttribute("lang").toLowerCase():n.hasAttribute("xml:lang")?n.getAttribute("xml:lang").toLowerCase():null},getNLS:function(e,n){if(!e)return null;if(IBMa.Config.locale in IBMa.Config.nls&&e in IBMa.Config.nls[IBMa.Config.locale]){if(void 0==n||"undefined"==typeof n)return IBMa.Config.nls[IBMa.Config.locale][e];var t=IBMa.Config.nls[IBMa.Config.locale][e],o=t;if(o=o.replace(/</g,"&lt;"),o=o.replace(/>/g,"&gt;"),n.length>0){var a=/{([0-9]+)}/g;o=o.replace(a,function(e,t){return n[t]})}return o}return e},getNLSMap:function(){return IBMa.Config.locale in IBMa.Config.nls?IBMa.Config.nls[IBMa.Config.locale]:null},populateResult:function(e,n){for(var t={"level.violation":0,"level.potentialviolation":1,"level.recommendation":2,"level.manual":3},o=[],a=e.ruleId,r=IBMa.Config.metadata[a],i=0;i<r.length;++i){var l={severity:IBMa.Config.sevMap2[r[i].rptSeverityCode],severityCode:IBMa.Config.sevMap[r[i].rptSeverityCode],message:IBMa.Config.getNLS(r[i].rptMessageCode,e.msgArgs),messageCode:r[i].rptMessageCode,ruleId:r[i].id,help:"idhi_accessibility_check_g"+r[i].id+".html"};for(var d in e)d in l||(l[d]=e[d]);var s=null;l.rsInfo=[];var u=IBMa.Config.rsMap[l.ruleId];if(u)for(var f=0;f<u.length;++f)(!n||u[f].rs.id in n)&&(l.rsInfo.push(u[f]),null==s?s=u[f].levelCode:t[u[f].levelCode].idx<t[s]&&(s=u[f].levelCode));l.level=s,o.push(l)}return o},populateResults:function(e,n){for(var t=[],o=0;o<e.length;++o)t=t.concat(IBMa.Config.populateResult(e[o],n));return t}},IBMa.Config.sevMap={"rpt.severity.high":"eISHigh","rpt.severity.medium":"eISMedium","rpt.severity.low":"eISLow","rpt.severity.information":"eISInformation"},IBMa.Config.sevMap2={"rpt.severity.high":"High","rpt.severity.medium":"Medium","rpt.severity.low":"Low","rpt.severity.information":"Information"},IBMa.Scan=IBMa.Scan||{reportDocument:function(e,n,t){IBMa.Config.DEBUG&&console.log("reportDocument");try{if(IBMa.Config.loaded){var o=null;if(n){o={};for(var a=0;a<n.length;++a)n[a]in IBMa.Config.rs?o[n[a]]=!0:n.splice(a--,1)}IBMa.Scan.setRulesets(n),IBMa.Scan.scanDocument(e,function(e){e.counts={"level.violation":0,"level.potentialviolation":0,"level.recommendation":0,"level.potentialrecommendation":0,"level.manual":0},e.report&&(e.report.pass&&(e.report.pass=IBMa.Config.populateResults(e.report.pass,o)),e.report.fail&&(e.report.fail=IBMa.Config.populateResults(e.report.fail,o),e.report.fail.forEach(function(n){n.level in e.counts||(e.counts[n.level]=0),e.counts[n.level]=e.counts[n.level]+1}))),t(e,n)})}else setTimeout(function(){IBMa.Scan.reportDocument(e,n,t)},1e3)}catch(r){t({exception:""+r},n)}},setRulesets:function(e){IBMa.Config.DEBUG&&console.log("setRulesets");var n=0;for(var t in IBMa.Config.rulesById)++n,IBMa.Config.rulesById[t].enabled=!e;if(IBMa.Config.DEBUG&&console.log((e?"Disabled ":"Enabled ")+n+" rules"),e){"string"==typeof e&&(e=e.split(",")),n=0;
console.log(IBMa.Config.rulesById["RPT_Html_TriggerOnce"]);
for(var o=0;o<e.length;++o){var a=IBMa.Config.getRulesetById(e[o]);
    if(a) {
        for(var r=0;r<a.requirements.length;++r) {
            for(var i in a.requirements[r].rules) {
                if (i === "207") console.log("FOUND");
                if(i in IBMa.Config.metadataId){
                    var t=IBMa.Config.metadataId[i].ruleId;t in IBMa.Config.rulesById?(IBMa.Config.rulesById[t].enabled||++n,IBMa.Config.rulesById[t].enabled=!0):IBMa.Error.log("Inconsistency in metadata for rule:",t)
                }else IBMa.Error.log("ERROR: Meta ID "+i+" not found from ruleset "+e[o])
            }
        }
    }
}
console.log(IBMa.Config.rulesById["RPT_Html_TriggerOnce"]);
IBMa.Config.DEBUG&&console.log("Enabled "+n+" rules")}},scanDocument:function(e,n){IBMa.Config.DEBUG&&console.log("scanDocument");try{IBMa.Config.ruleDocument.validationGlobals={},IBMa.Scan.stripFirebug(e);var t=new IBMa.Dom.NodeWalker(e.documentElement);if(e.documentElement.EXT_SCANNED){var o=new IBMa.Dom.NodeWalker(e.documentElement);IBMa.Config.setTimeout(function(){IBMa.Scan.cleanIter(o,t,n)},0)}else e.documentElement.EXT_SCANNED=!0,IBMa.Config.setTimeout(function(){IBMa.Scan.checkIter(t,n,null)},0)}catch(a){IBMa.Error.log(a),n({result:"EXCEPTION",details:a})}},stripFirebug:function(e){IBMa.Config.DEBUG&&console.log("stripFirebug");for(var n=e.getElementsByTagName("style"),t=0;t<n.length;t++){var o=n[t];o.wrappedJSObject&&1==o.wrappedJSObject.firebugIgnore&&o.parentNode.removeChild(o)}for(var a=new IBMa.Dom.NodeWalker(e,!0);null!=a.node&&"body"!=a.node.nodeName.toLowerCase()&&a.prevNode(););if(null!=a.node&&a.node.firstChild&&a.prevNode())for(;a.node!=e&&a.node.firebugIgnore;){var r=a.node;a.bEndTag=!1,a.prevNode(),r.parentNode.removeChild(r)}var i=e.getElementById("_firebugConsole");i&&i.parentNode.removeChild(i)},isNodeVisible:function(e){3==e.nodeType&&(e=e.parentNode);var n=e.nodeName.toLowerCase();if("script"==n)return!0;if("area"!=n&&"param"!=n&&"audio"!=n){var t=e.ownerDocument.defaultView.getComputedStyle(e,null);if("none"==t.getPropertyValue("display")||"hidden"==t.getPropertyValue("visibility"))return!1}for(var o=e.parentNode;null!=o&&1==o.nodeType;){if(t=o.ownerDocument.defaultView.getComputedStyle(o,null),"none"==t.getPropertyValue("display"))return!1;o=o.parentNode}return!0},cleanIter:function(e,n,t){IBMa.Config.DEBUG&&console.log("cleanIter");try{var o=100;do if(!e.bEndTag){var a=["Rpt_Aria_OrphanedContent","Rpt_Aria_OrphanedContent_NoTrigger","IBM_hasLandmarks","Valerie_Table_DataCellRelationships","Valerie_Table_DataCellRelationships_TrigOnce","rpt_input_buttonsubmittrigger","EXT_Color_Contrast_WCAG2AA","EXT_Link_Contrast_WCAG2AA"];do for(var r=0;r<a.length;++r)delete e.node[a[r]];while(e.nextNode())}while(e.nextNode()&&--o>0);0==o?IBMa.Config.setTimeout(function(){IBMa.Scan.cleanIter(e,n,t)},0):IBMa.Config.setTimeout(function(){IBMa.Scan.checkIter(n,t,null)},0)}catch(i){IBMa.Error.log(i),t({result:"EXCEPTION",details:i})}},evalRule:function(e,n){for(var t=0;10>t;++t)try{var o=n.ownerDocument;IBMa.Config.ruleDocument.setDoc&&IBMa.Config.ruleDocument.setDoc(o);var a=e.validate(n);return a}catch(r){if(9==t)return(IBMa.Config.DEBUG||IBMa.Config.DEBUG_RULES)&&IBMa.Error.log(e.id,r,r.stack),null}},checkIter:function(e,n,t){var o=(new Date).getTime();t||(t={pass:[],fail:[],numChecked:0,numTrigger:0,ruleTime:0,totalTime:0}),IBMa.Config.DEBUG&&console.log("checkIter");try{var a=IBMa.Config.ITER_COUNT;do if(e.node.getAttribute&&"CCE"===e.node.getAttribute("IBMa"))e.bEndTag=!0;else if(!e.bEndTag&&8!=e.node.nodeType){var r=e.node.nodeName.toLowerCase();if(e.node.parentNode&&e.node.parentNode.FB_DATA){var i=e.node.parentNode.FB_DATA;r in i.CN?e.node.FB_DATA={XPATH:i.XPATH+"/"+r+"["+(i.CN[r]+1)+"]",CN:{}}:(i.CN[r]=0,e.node.FB_DATA={XPATH:i.XPATH+"/"+r+"["+(i.CN[r]+1)+"]",CN:{}}),i.CN[r]=i.CN[r]+1}else e.node.FB_DATA={XPATH:"/"+r+"[1]",CN:{}};var l,d,s=IBMa.Config.getMatchingRules(e.node),u={};l=null;for(var f=0;f<s.length;++f)if(s[f].enabled&&!(s[f].id in u))try{var g=!0;if(s[f].dependencies)for(var c=0;c<s[f].dependencies.length;++c)if(!u[s[f].dependencies[c]]){g=!1;break}if(!g)continue;var I=(new Date).getTime(),B=IBMa.Scan.evalRule(s[f],e.node);++t.numChecked;var M=(new Date).getTime();if(t.ruleTime+=M-I,M-I>1e3&&console.log("Slow rule (>1s): "+s[f].id),B&&(u[s[f].id]=B.result,IBMa.Config.includePassed||B.result===!1)){null===l&&IBMa.Config.includeVisibility&&(l=IBMa.Scan.isNodeVisible(e.node));var C={component:e.node.FB_DATA.XPATH,displayId:s[f].id,msgArgs:B.msgArgs?B.msgArgs:[],visible:l,ruleId:s[f].id};if(IBMa.Config.includeNodes&&(C.componentNode=e.node),!d&&IBMa.Config.includeBounds&&e.node.getBoundingClientRect){var p=1;e.node.ownerDocument&&e.node.ownerDocument.defaultView&&e.node.ownerDocument.defaultView.devicePixelRatio&&(p=e.node.ownerDocument.defaultView.devicePixelRatio);var h=e.node.getBoundingClientRect();C.bounds=d={left:Math.ceil(h.left*p),top:Math.ceil(h.top*p),height:Math.ceil(h.height*p),width:Math.ceil(h.width*p)}}else IBMa.Config.includeBounds&&(C.bounds=d);if(e.node.hasAttribute("IBMacustom"))try{C.IBMacustom=JSON.parse(e.node.getAttribute("IBMacustom"))}catch(m){IBMa.Error.log(m)}B.result===!0&&t.pass.push(C),B.result===!1&&(++t.numTrigger,t.fail.push(C))}}catch(m){return IBMa.Error.log(m,e.node.nodeName),void n({result:"EXCEPTION",details:m})}}while(e.nextNode()&&--a>0);var v=(new Date).getTime();t.totalTime+=v-o,0==a?IBMa.Config.setTimeout(function(){IBMa.Scan.checkIter(e,n,t)},0):(IBMa.Config.DEBUG&&console.log("checkIter complete. Checked",t.numChecked,"in",t.timeChecked,t.debugTime),IBMa.Config.includePassed||delete t.pass,IBMa.Config.setTimeout(function(){n({report:t})},0))}catch(m){return IBMa.Error.log(m),void n({result:"EXCEPTION",details:m})}}}}();var fs=require("fs"),request=require("request");IBMa.Config.setTimeout=function(e,n){process.nextTick(e)},IBMa.GSALoader={loading:1,initStarted:!1,initCBs:[],ROOTURL:"http://ausgsa.ibm.com/projects/h/haactools/w3/magicbutton/plugincfg/rules-json-a11y/",useCache:!1,init:function(e){"string"==typeof IBMa.GSALoader.ROOTURL&&(IBMa.GSALoader.ROOTURL=[{cache:"default",url:IBMa.GSALoader.ROOTURL}]),IBMa.GSALoader.initStarted?IBMa.Config.loaded?e&&e():e&&IBMa.GSALoader.initCBs.push(e):(IBMa.GSALoader.initStarted=!0,e&&IBMa.GSALoader.initCBs.push(e),IBMa.GSALoader.loading=4*IBMa.GSALoader.ROOTURL.length,IBMa.Config.DEBUG&&console.log("INITIAL load count="+IBMa.GSALoader.loading),IBMa.GSALoader.loadJSON("nls.json",function(e){IBMa.Config.addNLS("en-us",e),--IBMa.GSALoader.loading,0==IBMa.GSALoader.loading&&IBMa.GSALoader.onLoaded()}),IBMa.GSALoader.loadJSON("rulesets.json",function(e){for(var n=0;n<e.length;++n)IBMa.Config.addRuleset(e[n]);--IBMa.GSALoader.loading,0==IBMa.GSALoader.loading&&IBMa.GSALoader.onLoaded()}),IBMa.GSALoader.loadJSON("metadata.json",function(e){IBMa.Config.addMetadata(e),--IBMa.GSALoader.loading,0==IBMa.GSALoader.loading&&IBMa.GSALoader.onLoaded()}),IBMa.GSALoader.loadRules("rules.js",function(e){IBMa.Config.addRules(e),--IBMa.GSALoader.loading,0==IBMa.GSALoader.loading&&IBMa.GSALoader.onLoaded()}))},fireConfigLoaded:function(e){e&&IBMa.GSALoader.initCBs.push(e),IBMa.GSALoader.initStarted=!0,IBMa.GSALoader.loading=0,IBMa.GSALoader.onLoaded()},onLoaded:function(){for(IBMa.Config.DEBUG&&console.log("onLoaded"),IBMa.Config.loaded=!0;IBMa.GSALoader.initCBs.length>0;)IBMa.GSALoader.initCBs.pop()()},loadRules:function(e,n){for(var t=0;t<IBMa.GSALoader.ROOTURL.length;++t){var o=__dirname+"/cache/"+IBMa.GSALoader.ROOTURL[t].cache+"-"+e;if(IBMa.GSALoader.useCache&&fs.existsSync(o))IBMa.Config.ruleDocument=require(o),n(IBMa.Config.ruleDocument.rules);else{++IBMa.GSALoader.loading;var a=IBMa.GSALoader.ROOTURL[t].url+e,r={};IBMa.Config.pem&&(r.agentOptions={ca:IBMa.Config.pem}),request(a,r,function(t,r,i){t||200!=r.statusCode?console.log("Got an error: ",t,", file: ",e," fileUrl: ",a):(i='var document = null;var window = null;module.exports = { "rules" : []};module.exports.setDoc = function(doc) {document = doc;window=doc.defaultView;};var OpenAjax = { "a11y" : { "ruleMap" : {},"addRules" : function(rules) {for (var i=0; i<rules.length; ++i) { module.exports.rules.push(rules[i]); OpenAjax.a11y.ruleMap[rules[i].id]=rules[i];}},"getRule" : function(ruleId) {return OpenAjax.a11y.ruleMap[ruleId];}}};var ValidationResult = function(result, nodes, attrs, text, msgArgs) {this.result = typeof result == "boolean" ? result : Boolean(result);this.nodes = nodes;this.attrs = attrs;this.textContent = text;this.msgArgs = msgArgs;return true;};var XPathResult =  { "ANY_TYPE": 0, "NUMBER_TYPE": 1, "STRING_TYPE": 2, "BOOLEAN_TYPE": 3,"UNORDERED_NODE_ITERATOR_TYPE": 4, "ORDERED_NODE_ITERATOR_TYPE": 5, "UNORDERED_NODE_SNAPSHOT_TYPE": 6,"ORDERED_NODE_SNAPSHOT_TYPE": 7, "ANY_UNORDERED_NODE_TYPE": 8, "FIRST_ORDERED_NODE_TYPE": 9 };'+i,fs.writeFileSync(o,i),IBMa.Config.ruleDocument=require(o),n(IBMa.Config.ruleDocument.rules),--IBMa.GSALoader.loading,0==IBMa.GSALoader.loading&&IBMa.GSALoader.onLoaded())})}}},loadJSON:function(e,n){for(var t=0;t<IBMa.GSALoader.ROOTURL.length;++t){var o=__dirname+"/cache/"+IBMa.GSALoader.ROOTURL[t].cache+"-"+e;if(IBMa.GSALoader.useCache&&fs.existsSync(o))n(require(o));else{++IBMa.GSALoader.loading;var a=IBMa.GSALoader.ROOTURL[t].url+e,r={};IBMa.Config.pem&&(r.agentOptions={ca:IBMa.Config.pem}),request(a,r,function(t,r,i){t||200!=r.statusCode?console.log("Got an error: ",t,", file: ",e," fileUrl: ",a):(fs.writeFileSync(o,i),n(require(o)),--IBMa.GSALoader.loading,0==IBMa.GSALoader.loading&&IBMa.GSALoader.onLoaded())})}}},addServers:function(e){IBMa.GSALoader._serverInfo=e}},IBMa.validate=function(e,n,t){IBMa.GSALoader.init(function(){IBMa.Config.DEBUG&&console.log("validate::init complete");try{1==e.nodeType&&(e=e.ownerDocument),IBMa.Scan.reportDocument(e,n,t)}catch(o){t({exceptionD:""+o})}})};var ValidationResult=function(e,n,t,o,a){return this.result="boolean"==typeof e?e:Boolean(e),this.nodes=n,this.attrs=t,this.textContent=o,this.msgArgs=a,!0},getRule=function(e){return IBMa.Config.rulesById[e]};module.exports=IBMa;